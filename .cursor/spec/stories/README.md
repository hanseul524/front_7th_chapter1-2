# 반복 일정 기능 설계 문서

## 📚 문서 개요
이 디렉토리는 캘린더 애플리케이션의 **반복 일정 기능**에 대한 상세 설계 문서를 포함합니다.

## 🎯 기능 목표
사용자가 일정을 생성할 때 반복 설정(매일/매주/매월/매년)을 선택하고, 이를 캘린더에 표시하며, 개별 또는 전체 수정/삭제가 가능하도록 합니다.

## 📋 설계 문서 목록

### 1. [반복 일정 생성 및 선택](./01-repeat-event-creation.md)
**목적**: 일정 폼에서 반복 유형 선택 UI 및 데이터 저장

**주요 내용**:
- 반복 유형 선택 (매일/매주/매월/매년)
- 반복 간격 설정
- 반복 종료일 설정 (최대 2025-12-31)
- 유효성 검증

**영향받는 파일**:
- `src/App.tsx` - UI 활성화
- `src/hooks/useEventForm.ts` - 상태 관리
- `src/utils/repeatValidation.ts` - 검증 로직 (신규)

---

### 2. [반복 일정 표시](./02-repeat-event-display.md)
**목적**: 캘린더와 목록에서 반복 일정을 시각적으로 구분

**주요 내용**:
- 반복 아이콘 표시 (Material-UI Repeat 아이콘)
- 월간/주간 뷰에서 아이콘 표시
- 일정 목록에서 반복 정보 표시
- 접근성 고려 (aria-label)

**영향받는 파일**:
- `src/App.tsx` - 렌더링 로직 수정
- `src/utils/eventUtils.ts` - 유틸리티 함수 추가

---

### 3. [반복 일정 수정](./03-repeat-event-update.md)
**목적**: 반복 일정 수정 시 단일/전체 선택 기능

**주요 내용**:
- 수정 확인 다이얼로그 ("해당 일정만 수정하시겠어요?")
- 단일 수정: 반복에서 분리, 아이콘 제거
- 전체 수정: 모든 반복 일정 업데이트
- repeat.id로 그룹 관리

**영향받는 파일**:
- `src/types.ts` - `RepeatInfo.id?` 필드 추가
- `src/App.tsx` - 확인 다이얼로그
- `src/hooks/useEventOperations.ts` - 전체 수정 로직
- `server.js` - API 엔드포인트 추가

---

### 4. [반복 일정 삭제](./04-repeat-event-delete.md)
**목적**: 반복 일정 삭제 시 단일/전체 선택 기능

**주요 내용**:
- 삭제 확인 다이얼로그 ("해당 일정만 삭제하시겠어요?")
- 단일 삭제: 해당 일정만 제거
- 전체 삭제: 모든 반복 일정 제거
- 안전성 고려 (실수 방지)

**영향받는 파일**:
- `src/App.tsx` - 확인 다이얼로그
- `src/hooks/useEventOperations.ts` - 전체 삭제 로직
- `server.js` - API 엔드포인트 추가

---

### 5. [반복 일정 생성 로직](./05-repeat-event-generation.md)
**목적**: 반복 설정에 따라 실제 이벤트 인스턴스 생성

**주요 내용**:
- 매일/매주/매월/매년 반복 계산
- **특수 케이스**: 매월 31일 → 31일 있는 달만
- **특수 케이스**: 윤년 2/29 → 윤년만
- 2025-12-31까지 제한
- 반복 일정 겹침 무시

**영향받는 파일**:
- `src/utils/repeatUtils.ts` - 반복 생성 로직 (신규)
- `server.js` - API 통합

---

## 🏗️ 아키텍처 개요

```
┌─────────────────────────────────────────────────────┐
│                    사용자 입력                       │
│  (반복 유형, 간격, 종료일)                          │
└───────────────────┬─────────────────────────────────┘
                    │
                    ▼
┌─────────────────────────────────────────────────────┐
│              useEventForm 훅                         │
│  (상태 관리 + 유효성 검증)                          │
└───────────────────┬─────────────────────────────────┘
                    │
                    ▼
┌─────────────────────────────────────────────────────┐
│           useEventOperations 훅                      │
│  (API 호출 + 이벤트 CRUD)                           │
└───────────────────┬─────────────────────────────────┘
                    │
                    ▼
┌─────────────────────────────────────────────────────┐
│              Server API                              │
│  (반복 일정 생성 + 그룹 관리)                       │
└───────────────────┬─────────────────────────────────┘
                    │
                    ▼
┌─────────────────────────────────────────────────────┐
│           반복 일정 생성 로직                        │
│  (repeatUtils.ts - 날짜 계산)                       │
└───────────────────┬─────────────────────────────────┘
                    │
                    ▼
┌─────────────────────────────────────────────────────┐
│             캘린더 표시                              │
│  (App.tsx - 반복 아이콘 표시)                       │
└─────────────────────────────────────────────────────┘
```

## 🔑 핵심 개념

### repeat.id (시리즈 식별자)
- 같은 반복 그룹의 일정들을 식별하는 고유 ID
- 전체 수정/삭제 시 사용
- 형식: `"repeat-{timestamp}-{random}"`

### 단일 vs 전체 수정/삭제
| 작업 | 단일 | 전체 |
|------|------|------|
| **수정** | 반복에서 분리 (`repeat.type = 'none'`) | 그룹 전체 업데이트 |
| **삭제** | 해당 일정만 제거 | 그룹 전체 제거 |
| **아이콘** | 사라짐 | 유지 |
| **API** | `PUT /api/events/:id` | `PUT /api/recurring-events/:repeatId` |

### 특수 케이스 처리
1. **매월 31일**: 31일이 있는 달에만 생성 (1,3,5,7,8,10,12월)
2. **윤년 2월 29일**: 윤년에만 생성
3. **반복 종료일**: 최대 2025-12-31까지
4. **겹침**: 반복 일정은 겹침 체크 안 함

## 📁 파일 구조

```
src/
├── types.ts                    # RepeatInfo.id 추가
├── App.tsx                     # UI 수정 (아이콘, 다이얼로그)
├── hooks/
│   ├── useEventForm.ts        # 반복 상태 관리
│   └── useEventOperations.ts  # 그룹 수정/삭제 추가
├── utils/
│   ├── repeatValidation.ts    # 유효성 검증 (신규)
│   ├── repeatUtils.ts          # 반복 생성 로직 (신규)
│   └── eventUtils.ts           # 반복 관련 유틸 추가
└── __tests__/
    ├── unit/
    │   ├── easy.repeatValidation.spec.ts  (신규)
    │   ├── easy.repeatUtils.spec.ts       (신규)
    │   └── easy.eventUtils.spec.ts        (수정)
    └── integration/
        ├── repeat-update.spec.tsx          (신규)
        └── repeat-delete.spec.tsx          (신규)

server.js  # 반복 그룹 API 추가
```

## 🔄 작업 순서 (권장)

### Phase 1: 기본 구조
1. ✅ 타입 정의 확장 (`RepeatInfo.id` 추가)
2. ✅ 반복 생성 로직 구현 (`repeatUtils.ts`)
3. ✅ 유효성 검증 구현 (`repeatValidation.ts`)
4. ✅ 단위 테스트 작성

### Phase 2: UI 구현
5. ✅ 반복 설정 UI 활성화 (App.tsx)
6. ✅ 반복 아이콘 표시 (eventUtils.ts, App.tsx)
7. ✅ 확인 다이얼로그 추가 (수정/삭제)

### Phase 3: API 통합
8. ✅ 서버 API 구현 (반복 생성, 그룹 수정, 그룹 삭제)
9. ✅ 훅 업데이트 (useEventOperations)
10. ✅ 통합 테스트

### Phase 4: 테스트 및 최적화
11. ✅ 특수 케이스 테스트 (31일, 윤년)
12. ✅ 성능 최적화
13. ✅ 접근성 검증

## ⚠️ 주의사항

### 필수 구현 사항
- ✅ 매월 31일 → 31일 있는 달만 (마지막 날 X)
- ✅ 윤년 2월 29일 → 윤년만
- ✅ 2025-12-31까지 제한
- ✅ 반복 일정 겹침 무시

### 사용자 경험
- 확인 다이얼로그 문구 명확히 ("해당 일정만 ~")
- 삭제된 개수 피드백 ("N개 삭제됨")
- 로딩 상태 표시 (대량 작업 시)
- 에러 처리 및 사용자 피드백

### 성능 고려
- 최대 365개 일정 생성 (매일, 1년)
- 무한 루프 방지 (MAX_ITERATIONS)
- 서버 측 배치 처리
- 클라이언트 캐시 최적화

## 📝 테스트 체크리스트

### 단위 테스트
- [ ] 반복 날짜 계산 (매일/매주/매월/매년)
- [ ] 매월 31일 특수 케이스
- [ ] 윤년 2월 29일 특수 케이스
- [ ] 유효성 검증 (종료일, 간격)
- [ ] 반복 아이콘 표시 로직

### 통합 테스트
- [ ] 반복 일정 생성 플로우
- [ ] 단일/전체 수정 플로우
- [ ] 단일/전체 삭제 플로우
- [ ] 캘린더 표시 (아이콘 포함)


## ▶️ 실행 방법
- 개발 서버 실행: `pnpm start`
- 접속 URL: `http://localhost:5173`

